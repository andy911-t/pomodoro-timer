<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30:00 — Sync Focus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        /* "Matrix Mint & Red" Theme */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #050505; /* Deepest Black */
            color: #e5e5e5; 
            -webkit-font-smoothing: antialiased; 
        }
        
        .glass-card { 
            background: rgba(20, 20, 20, 0.8); /* Darker, stealthy card */
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(74, 222, 128, 0.1); /* Subtle green glow border */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }
        
        /* Monospace font for the timer to look like code */
        .timer-display { 
            font-family: 'JetBrains Mono', monospace;
            font-variant-numeric: tabular-nums; 
            letter-spacing: -0.05em; 
            color: #4ade80; /* Neon Mint */
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.2); /* Soft glow */
        }
        
        .dot { 
            width: 6px; height: 6px; border-radius: 50%; 
            background: #262626; transition: all 0.4s ease; 
        }
        .dot.active { 
            background: #4ade80; /* Green active dots */
            box-shadow: 0 0 8px rgba(74, 222, 128, 0.5); 
        }
        
        .btn-transition { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="h-screen flex items-center justify-center overflow-hidden">

    <div class="w-full max-w-md px-6">
        <div class="glass-card rounded-[32px] p-12 text-center relative">
            
            <div id="session-dots" class="flex justify-center gap-2 mb-8">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>

            <div id="mode-label" class="text-[10px] uppercase tracking-[0.3em] text-neutral-500 mb-8 font-bold">Deep Work</div>
            
            <div id="timer" class="timer-display text-8xl font-medium mb-12">30:00</div>

            <div class="flex flex-col gap-4">
                <button id="toggle-btn" class="btn-transition w-full py-4 bg-[#4ade80] text-black rounded-xl font-bold hover:bg-[#22c55e] active:scale-[0.98] shadow-[0_0_15px_rgba(74,222,128,0.3)]">
                    Start
                </button>
                
                <div class="flex gap-3">
                    <button id="reset-btn" class="btn-transition flex-1 py-3 bg-neutral-900/50 text-rose-500 rounded-xl text-xs font-semibold border border-rose-900/30 hover:bg-rose-950/30 hover:border-rose-500/50 hover:text-rose-400">
                        Reset Timer
                    </button>
                    <button id="next-btn" class="btn-transition flex-1 py-3 bg-neutral-900/50 text-rose-500 rounded-xl text-xs font-semibold border border-rose-900/30 hover:bg-rose-950/30 hover:border-rose-500/50 hover:text-rose-400">
                        Next Phase
                    </button>
                </div>
                
                <div class="mt-8 pt-6 border-t border-white/5 relative">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 flex gap-2">
                        <button id="log-sheet-btn" class="bg-green-900/30 text-green-400 hover:text-green-300 hover:bg-green-900/50 text-[9px] px-3 py-1 rounded border border-green-800/50 transition-colors uppercase tracking-wider font-semibold">
                            Log to Sheet
                        </button>
                        <button id="reset-stats-btn" class="bg-red-900/30 text-red-400 hover:text-red-300 hover:bg-red-900/50 text-[9px] px-3 py-1 rounded border border-red-800/50 transition-colors uppercase tracking-wider font-semibold">
                            Reset
                        </button>
                    </div>

                    <div class="flex justify-between text-[10px] uppercase tracking-widest text-neutral-600 mt-2 font-semibold">
                        <div class="text-left">
                            <p class="mb-1 text-green-700">Total Work</p>
                            <span id="total-work" class="text-green-400 text-sm font-mono">00:00:00</span>
                        </div>
                        <div class="text-right">
                            <p class="mb-1 text-red-800">Total Rest</p>
                            <span id="total-rest" class="text-red-500 text-sm font-mono">00:00:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // ============================================
        //  YOUR FIREBASE CONFIG
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAaXrGGPPR5G1X8zNVBuvIhHLeBcXIkABA",
            authDomain: "pomodoro-fe692.firebaseapp.com",
            databaseURL: "https://pomodoro-fe692-default-rtdb.firebaseio.com/",
            projectId: "pomodoro-fe692",
            storageBucket: "pomodoro-fe692.firebasestorage.app",
            messagingSenderId: "578181442459",
            appId: "1:578181442459:web:71edaca2813b52ce5f8f3e",
            measurementId: "G-Z569M8NMMG"
        };

        // ============================================
        //  ⚠️ PASTE YOUR GOOGLE SCRIPT URL BELOW ⚠️
        // ============================================
        const GOOGLE_SCRIPT_URL = "PASTE_YOUR_LONG_URL_HERE"; 
        // ============================================

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const timerRef = ref(db, 'shared-timer');

        const MODES = { 
            WORK: { label: 'Deep Work', time: 30 * 60 }, 
            SHORT: { label: 'Short Break', time: 5 * 60 }, 
            LONG: { label: 'Long Break', time: 30 * 60 } 
        };

        let currentMode = 'WORK', timeLeft = MODES.WORK.time, timerId = null, alarmId = null, sessionCount = 0;
        let totalWorkSeconds = 0, totalRestSeconds = 0;

        const timerDisplay = document.getElementById('timer'), modeLabel = document.getElementById('mode-label');
        const toggleBtn = document.getElementById('toggle-btn'), resetBtn = document.getElementById('reset-btn'), nextBtn = document.getElementById('next-btn');
        const resetStatsBtn = document.getElementById('reset-stats-btn'), logSheetBtn = document.getElementById('log-sheet-btn');
        const dots = document.querySelectorAll('.dot'), workStat = document.getElementById('total-work'), restStat = document.getElementById('total-rest');

        function playTone() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator(); const gain = ctx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(880, ctx.currentTime);
            gain.gain.setValueAtTime(0, ctx.currentTime); gain.gain.linearRampToValueAtTime(0.1, ctx.currentTime + 0.05); gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.5);
            osc.connect(gain); gain.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime + 1.5);
        }

        function startAlarm() {
            toggleBtn.textContent = "Complete - Start Next";
            // Alarm Color: Shift from Green to Orange
            toggleBtn.classList.replace('bg-[#4ade80]', 'bg-orange-600'); 
            toggleBtn.classList.replace('text-black', 'text-white'); 
            toggleBtn.classList.add('animate-pulse');
            
            playTone(); setTimeout(playTone, 800);
            if(!alarmId) alarmId = setInterval(() => { playTone(); setTimeout(playTone, 800); }, 4000);
        }

        function stopAlarm() {
            if (alarmId) { clearInterval(alarmId); alarmId = null; }
            toggleBtn.classList.replace('bg-orange-600', 'bg-[#4ade80]'); 
            toggleBtn.classList.replace('text-white', 'text-black'); 
            toggleBtn.classList.remove('animate-pulse');
        }

        const format = (s) => new Date(s * 1000).toISOString().substr(11, 8);

        function updateDisplay() {
            const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const secs = (timeLeft % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${mins}:${secs}`;
            modeLabel.textContent = MODES[currentMode].label;
            dots.forEach((dot, i) => dot.classList.toggle('active', i < sessionCount));
            workStat.textContent = format(totalWorkSeconds);
            restStat.textContent = format(totalRestSeconds);
        }

        function syncToCloud() {
            set(timerRef, { currentMode, timeLeft, sessionCount, totalWorkSeconds, totalRestSeconds });
        }

        function handleCycleEnd(shouldPlaySound = true) {
            clearInterval(timerId); timerId = null;
            if (currentMode === 'WORK') { sessionCount++; currentMode = (sessionCount >= 4) ? 'LONG' : 'SHORT'; } 
            else { if (currentMode === 'LONG') sessionCount = 0; currentMode = 'WORK'; }
            timeLeft = MODES[currentMode].time;
            updateDisplay(); 
            if (shouldPlaySound) startAlarm(); 
            syncToCloud();
        }

        toggleBtn.addEventListener('click', () => {
            if (alarmId) { stopAlarm(); toggleBtn.click(); return; }
            if (timerId) { clearInterval(timerId); timerId = null; toggleBtn.textContent = 'Resume'; syncToCloud(); } 
            else {
                toggleBtn.textContent = 'Pause';
                const ctx = new (window.AudioContext || window.webkitAudioContext)(); if (ctx.state === 'suspended') ctx.resume();
                timerId = setInterval(() => {
                    timeLeft--;
                    if (currentMode === 'WORK') totalWorkSeconds++; else totalRestSeconds++;
                    if (timeLeft <= 0) handleCycleEnd(true);
                    updateDisplay();
                    if (timeLeft % 5 === 0) syncToCloud();
                }, 1000);
            }
        });

        resetBtn.addEventListener('click', () => { stopAlarm(); clearInterval(timerId); timerId = null; timeLeft = MODES[currentMode].time; toggleBtn.textContent = 'Start'; updateDisplay(); syncToCloud(); });
        nextBtn.addEventListener('click', () => { stopAlarm(); handleCycleEnd(false); stopAlarm(); toggleBtn.textContent = 'Start'; updateDisplay(); syncToCloud(); });

        resetStatsBtn.addEventListener('click', () => {
            if(confirm("Are you sure you want to reset your daily stats?")) {
                totalWorkSeconds = 0; totalRestSeconds = 0; updateDisplay(); syncToCloud();
            }
        });

        logSheetBtn.addEventListener('click', () => {
            if(GOOGLE_SCRIPT_URL.includes("PASTE")) {
                alert("Please add your Google Script URL in the code first!");
                return;
            }
            logSheetBtn.textContent = "Saving...";
            const url = `${GOOGLE_SCRIPT_URL}?work=${format(totalWorkSeconds)}&rest=${format(totalRestSeconds)}`;
            fetch(url, { mode: 'no-cors' })
                .then(() => {
                    logSheetBtn.textContent = "Saved!";
                    setTimeout(() => logSheetBtn.textContent = "Log to Sheet", 2000);
                    if(confirm("Saved successfully! Reset stats for tomorrow?")) {
                        totalWorkSeconds = 0; totalRestSeconds = 0; updateDisplay(); syncToCloud();
                    }
                })
                .catch(err => { console.error(err); logSheetBtn.textContent = "Error"; });
        });

        onValue(timerRef, (snapshot) => {
            const data = snapshot.val();
            if (data && !timerId) {
                currentMode = data.currentMode; timeLeft = data.timeLeft; sessionCount = data.sessionCount;
                totalWorkSeconds = data.totalWorkSeconds; totalRestSeconds = data.totalRestSeconds;
                updateDisplay();
            }
        });
        updateDisplay();
    </script>
</body>
</html>
